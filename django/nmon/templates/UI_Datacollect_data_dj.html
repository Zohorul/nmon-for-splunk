{% extends "UI_Datacollect_data_body.html" %}

{% load splunkmvc %}
{% load nmon %}

5: {% block title %}Calendar Heatmap - NMON Performance{% endblock title %}

{% block css %}
{{block.super}}
{% endblock css %}

    {% block heading %}

	<div class="customimgheader">
	
	<img src="{{STATIC_URL}}/nmon/logos/NMON_simplelogo.png" alt="Nmon"/>	
	<h1>NMON Data Analysis, Performance Monitors indexing</h1>

	</div>

	 {% endblock heading %}
    
    {% block searchcontrol %}

		{% searchcontrols
			id="searchcontrol1" 
			managerid="mainsearch" %}
			
    {% endblock searchcontrol %}
        
    {% block cal1 %}

		{% calendarheatmap 
                id="calendar1"
                managerid="hosts_perday"
                domain="month"
                subDomain="x_day" %}
		
    {% endblock cal1 %}

    {% block cal2 %}

		{% calendarheatmap 
                id="calendar2"
                managerid="events_perday"
                domain="month"
                subDomain="x_day" %}
		
    {% endblock cal2 %}
	
	
    {% block usage%}

        <table class="table table-striped table-bordered">


            <tr>
                <td>
					 <p></p>
                <h2>TimeRange:</h2>
                </td>
                <td>
                	<p></p>
    					{% timerange id="example-timerange" 
						managerid="example-search" 
        				preset="Last 30 days"
        				earliest_time="$earlyval$"|token_safe
        				latest_time="$lateval$"|token_safe %}                
						<p></p>                
                </td>
            </tr>

            <tr>
                <td>
                <h2>Filter by NMON Performance Monitor:</h2>
                </td>
                <td>
					 <p </p>
                {% dropdown id="filter-dropdowngroup" default="CPU_ALL" value="$filtermode$"|token_safe %}
                </td>
            </tr>

            <tr>
                <td>
					<p></p>
					<h2>Optional Filters</h2>
				</td>
					<td>

                <p></p>                
                <h2>Filter OS Type:</h2>
                <p></p>                
                {% radiogroup id="osfilter-radiogroup" default="" value="$valuesosfilter$"|token_safe%}
					
					<h2>Hosts and SN Filtering:</h2>					

					<p></p>
					<p>Multiple patterns can be used including wildwards and logical operators,ex: SP* OR SQ*</p>					
					
					<p>hostnames:</p>										
					{% textinput id="hosts-textinput" value="$valueshosts$"|token_safe default="*" %}	

					<p>serialnumbers:</p>					
					{% textinput id="sn-textinput" value="$valuessn$"|token_safe default="*" %}	


				</td>
            </tr>			


        </table>

		
    {% endblock usage%}
	
{% block managers %}
    
	{% searchmanager id="mainsearch"
      	search='index=nmon sourcetype=nmon_data type=$filtermode$ hostname=$valueshosts$ serialnum=$valuessn$ $valuesosfilter$ | bucket _time span=1d | stats count by _time,hostname,serialnum'|token_safe
			earliest_time="$earlyval$"|token_safe
			latest_time="$lateval$"|token_safe
			cache=False
			auto_cancel=60
			preview=True %}
			
	{% postprocessmanager 
			id="hosts_perday"
			managerid="mainsearch" 
			search='| timechart span=1d count As count | where count>0 | rename count As "Count of Hosts collected per day"' %}
			
	{% postprocessmanager 
			id="events_perday"
			managerid="mainsearch" 
			search='| timechart span=1d sum(count) As count | where count>0 | rename count As "Count of events per day"' %}
			

{% endblock managers %}



{% block js %}
{{ block.super }}
<script>
    require(["splunkjs/ready!",
            "jquery",
            "splunkjs/mvc/dropdownview",
            "nmon/components/calendarheatmap/calendarheatmap"
            ], 
            function(
                mvc,
                $,
                Dropdown,
                CalHeat) {

		var choices = [
        {label: " All (No filter) ", value: "*"},
        {label: " CPU_ALL ", value: "CPU_ALL"},
        {label: " DISKBSIZE ", value: "DISKBSIZE"},
        {label: " DISKBUSY ", value: "DISKBUSY"},
        {label: " DISKREAD ", value: "DISKREAD"},
        {label: " DISKWRITE ", value: "DISKWRITE"},
        {label: " DISKXFER ", value: "DISKXFER"},
        {label: " DISKRIO ", value: "DISKRIO"},
        {label: " DISKWIO ", value: "DISKWIO"},
        {label: " FILE ", value: "FILE"},
        {label: " IOADAPT ", value: "IOADAPT"},
        {label: " LPAR ", value: "LPAR"},
        {label: " MEM ", value: "MEM"},
        {label: " MEMNEW ", value: "MEMNEW"},
        {label: " MEMUSE ", value: "MEMUSE"},
        {label: " NET ", value: "NET"},
        {label: " NETERROR ", value: "NETERROR"},
        {label: " NETPACKET ", value: "NETPACKET"},
        {label: " NFSSVRV2 ", value: "NFSSVRV2"},
        {label: " NFSSVRV3 ", value: "NFSSVRV3"},
        {label: " NFSSVRV4 ", value: "NFSSVRV4"},
        {label: " NFSCLIV2 ", value: "NFSCLIV2"},
        {label: " NFSCLIV3 ", value: "NFSCLIV3"},
        {label: " NFSCLIV4 ", value: "NFSCLIV4"},
        {label: " PAGE ", value: "PAGE"},
        {label: " PROC ", value: "PROC"},
        {label: " PROCSOL ", value: "PROCSOL"},	
        {label: " TOP ", value: "TOP"},
        {label: " UARG ", value: "UARG"}
        ]
 
		// Assign them to the button group
		splunkjs.mvc.Components.getInstance("filter-dropdowngroup").settings.set("choices", choices);

		var choices = [
        {label: " Any OS", value: ""},
        {label: " AIX", value: "| search [ `nmon_inventory` | search OStype=AIX | stats count by hostname | fields hostname ]"},
        {label: " Solaris", value: "| search [ `nmon_inventory` | search OStype=Solaris | stats count by hostname | fields hostname ]"},
        {label: " Linux", value: "| search [ `nmon_inventory` | search OStype=Linux | stats count by hostname | fields hostname ]"}
        ] 
 
		// Assign them to the button group
		splunkjs.mvc.Components.getInstance("osfilter-radiogroup").settings.set("choices", choices);	

		
    });
</script>


{% endblock js %}
