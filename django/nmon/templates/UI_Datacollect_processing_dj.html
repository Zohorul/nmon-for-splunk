{% extends "UI_Datacollect_body.html" %}

{% load splunkmvc %}
{% load nmon %}

5: {% block title %}Calendar Heatmap - NMON Performance{% endblock title %}

{% block css %}
{{block.super}}
{% endblock css %}

    {% block heading %}

	<div class="customimgheader">
	
	<img src="{{STATIC_URL}}/nmon/logos/NMON_simplelogo.svg" alt="Nmon"/>	
	<h1>NMON Processing Analysis, Raw Data Processing</h1>

	</div>

	 {% endblock heading %}
    
    
    
    {% block cal1 %}

	<div style="text-align: center;"> 
    
		{% single 
            id="single1-maxvolume" 
            managerid="maxvolume"
            field="value"
				underLabel="Max volume per day" 
				afterLabel="MB" %}   

		{% single 
            id="single1-avgvolume" 
            managerid="avgvolume"
            field="value"
				underLabel="Avg volume per day"
				afterLabel="MB" %}    

		{% single 
            id="single1-minvolume" 
            managerid="minvolume"
            field="value"
				underLabel="Min volume per day" 
				afterLabel="MB" %}    

	</div>

		{% searchcontrols
			id="searchcontrol1" 
			managerid="nmon_perday" %}
	
		{% calendarheatmap 
                id="calendar1"
                managerid="nmon_perday"
                domain="month"
                subDomain="x_day" %}
		
    {% endblock cal1 %}
	
	
    {% block cal2 %}

	<div style="text-align: center;"> 
    
		{% single 
            id="single1-maxerror" 
            managerid="maxerror"
            field="value"
				underLabel="Max errors per day" %}

		{% single 
            id="single1-avgerror" 
            managerid="avgerror"
            field="value"
				underLabel="Avg errors per day" %}

	</div>

		{% searchcontrols
			id="searchcontrol2" 
			managerid="nmon_errorperday" %}
	
		{% calendarheatmap 
                id="calendar2"
                managerid="nmon_errorperday"
                domain="month"
                subDomain="x_day" %}
		
    {% endblock cal2 %}

    {% block cal3 %}

	<div style="text-align: center;"> 
    
		{% single 
            id="single1-maxelapsed" 
            managerid="maxelapsed"
            field="value"
				underLabel="Max time elapsed pey day" %}

		{% single 
            id="single1-avgelapsed" 
            managerid="avgelapsed"
            field="value"
				underLabel="Avg time elapsed per day" %}

		{% single 
            id="single1-minelapsed" 
            managerid="minelapsed"
            field="value"
				underLabel="Min time elapsed per day" %}

	</div>

		{% searchcontrols
			id="searchcontrol3" 
			managerid="total_elapsed" %}
	
		{% calendarheatmap 
                id="calendar3"
                managerid="total_elapsed"
                domain="month"
                subDomain="x_day" %}
		
    {% endblock cal3 %}


    {% block usage%}

		<div>

			<br />
			
			<h2>TimeRange:</h2>
		
    		{% timerange id="example-timerange" 
			managerid="example-search" 
        	preset="Last 30 days"
        	earliest_time="$earlyval$"|token_safe
        	latest_time="$lateval$"|token_safe %}

			<br />
		
		</div>

		
    {% endblock usage%}
	
{% block managers %}

	<!-- Volume of data per day -->
    
	{% searchmanager id="nmon_perday"
      	search='| tstats sum("NMON_Processing.size_in_MB") AS sum_size_MB from datamodel=NMON_Processing_Data_Collect where (nodename = NMON_Processing) groupby _time prestats=true span=1d | eval "_time"=_time | timechart dedup_splitvals=t sum("NMON_Processing.size_in_MB") AS sum_size_MB span=1d | sort limit=0 _time | fields _time, sum_size_MB'|token_safe
			earliest_time="$earlyval$"|token_safe
			latest_time="$lateval$"|token_safe
			auto_cancel=60
			cache=True
			preview=True %}
			
	{% postprocessmanager
			id="maxvolume"
			managerid="nmon_perday"
			auto_cancel=60
			search='stats max(sum_size_MB) AS value | eval value=round(value,0)' %}			

	{% postprocessmanager
			id="avgvolume"
			managerid="nmon_perday"
			auto_cancel=60
			search='stats avg(sum_size_MB) AS value | eval value=round(value,0)' %}			

	{% postprocessmanager
			id="minvolume"
			managerid="nmon_perday"
			auto_cancel=60
			search='stats min(sum_size_MB) AS value | eval value=round(value,0)' %}			
	
	<!-- Errors per day -->			
			
	{% searchmanager id="nmon_errorperday"
      	search='| tstats count AS Count from datamodel=NMON_Processing_Data_Collect where (nodename = NMON_Processing.Errors_in_Processing) groupby _time prestats=true span=1d | eval "_time"=_time | timechart dedup_splitvals=t count AS Count span=1d | sort limit=0 _time | fields _time, Count'|token_safe
			earliest_time="$earlyval$"|token_safe
			latest_time="$lateval$"|token_safe
			auto_cancel=60
			cache=True
			preview=True %}

	{% postprocessmanager
			id="maxerror"
			managerid="nmon_errorperday"
			auto_cancel=60
			search='stats max(Count) AS value | eval value=round(value,0)' %}			

	{% postprocessmanager
			id="avgerror"
			managerid="nmon_errorperday"
			auto_cancel=60
			search='stats avg(Count) AS value | eval value=round(value,0)' %}			

	<!-- Time elapsed -->			

	{% searchmanager id="total_elapsed"
      	search='| tstats sum("NMON_Processing.elapsed_in_seconds") AS "Sum of Elapsed in Seconds" from datamodel=NMON_Processing_Data_Collect where (nodename = NMON_Processing) groupby _time prestats=true span=1d | eval "_time"=_time | timechart dedup_splitvals=t sum("NMON_Processing.elapsed_in_seconds") AS "Sum of Elapsed in Seconds" span=1d | sort limit=0 _time | fields _time, "Sum of Elapsed in Seconds"'|token_safe
			earliest_time="$earlyval$"|token_safe
			latest_time="$lateval$"|token_safe
			auto_cancel=60
			cache=True
			preview=True %}

	{% postprocessmanager
			id="maxelapsed"
			managerid="total_elapsed"
			auto_cancel=60
			search='rename "Sum of Elapsed in Seconds" AS value | stats max(value) AS max | eval value=tostring(max,"duration")' %}			

	{% postprocessmanager
			id="avgelapsed"
			managerid="total_elapsed"
			auto_cancel=60
			search='rename "Sum of Elapsed in Seconds" AS value | stats avg(value) AS avg | eval value=tostring(avg,"duration")' %}		

	{% postprocessmanager
			id="minelapsed"
			managerid="total_elapsed"
			auto_cancel=60
			search='rename "Sum of Elapsed in Seconds" AS value | stats min(value) AS avg | eval value=tostring(min,"duration")' %}		

{% endblock managers %}



{% block js %}
{{ block.super }}


{% endblock js %}
